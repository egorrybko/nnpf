{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}
{% block content %}

    <input id="message-input" type="text" size="100"><br>
    <input id="btn-submit" type="button" value="Send">
    <div id="chat">
 
    </div>
    src="{% static 'js/script.js' %}"
    <script type="text/javascript">
    let chat = document.querySelector("#chat")
    let input = document.querySelector("#message-input")
    let btnSubmit = document.querySelector("#btn-submit")
    
    const webSocket = new WebSocket('ws://' + window.location.host + '/ws/chat/');

    webSocket.onmessage = function(e) {
        alert(`[message] Данные получены с сервера: ${e.data}`);
        const data = JSON.parse(e.data);
        chat.innerHTML += '<div class="msg">' + data.message + '</div>'
    };
    alert(`[error]`);
    webSocket.onerror = function(error) {
        alert(`[error]`);
    };
    
    btnSubmit.addEventListener("click", () => {
        message = input.value;
        webSocket.send(JSON.stringify({
            'message': message
        }));
        input.value = '';
    })
    </script>
    
{% endblock %}